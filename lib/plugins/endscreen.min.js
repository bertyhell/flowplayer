!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.endscreen=e())}(this,(function(){"use strict";var t="mount",e="click",n="loadstart",r="pause",i="playing",o="ended",a="reap",l="recommendationsready",s=[].slice;function u(t,e,n){for(e=function(t){return Array.isArray(t)?t.slice(0):t.split(".")}(e);e.length;){if(null==t)return n;t=t[e.shift()]}return null==t?n:t}var c=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},f=["touchstart","touchmove"];function p(t){return t.emit=function(e,n,r){r=r||{};var i=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(e);return n&&function(t,e){for(var n in e)t[n]=e[n]}(i,{data:n||{}}),t.dispatchEvent(i),!1===r.return_self?i:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~f.indexOf(t)}(e)?t.addEventListener(e,n,c):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(i){t.off(e,r),n(i)}))},t}var d=Array.isArray,y="undefined"!=typeof window&&p(window),m="undefined"!=typeof document&&p(document),v=["span","a","em","p","i"],h=v.concat(["div","strong","video","img","ol","ul","li","script"]);function _(t,e,n){var r=g(document.createElement(t));if(d(e)&&(n=e,e=!1),d(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var i in e)i in r?r[i]=e[i]:r.setAttribute(i,e[i]);return r}function b(t){var e=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?g(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var n=t.insert=function(e,n){return d(n)?n.map((function(n){return t.insert(e,n)}))[0]:g(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=n.bind(t,"beforeend"),t.prepend=n.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~v.indexOf(e)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(e){return n=t.querySelectorAll(e),s.call(n);var n},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function g(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:b(p(t))}function w(t,e){if("string"==typeof t&&"<"==t[0])return _(t.slice(1,-1),e);if("string"!=typeof t)return g(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?g(n):void 0}function L(t,e){if(1!=!!e)throw new Error(t)}function x(t,e){this.mode=e.mode,this.sort=e.sort||x._sort,this.members=this.sort(t.slice(0),e.mode),this.last_idx=this.members.length-1,this.plays=e.plays||0,this.idx=-1}w.window=y,w.document=m,w.el=_,h.forEach((function(t){w[t]=function(e,n){return"string"==typeof e&&(e={class:e}),_(t,e,n)}}));var A=x.modes={SHUFFLE:1,FIFO:2,LOOP:4};x.is_ended=function(t){return t.idx==t.last_idx},x.reduce=function(t,e,n){return t.members.reduce.apply(t.members,[].slice.call(arguments,1,arguments.length))},x.map=function(t,e){return t.members.map.apply(t.members,[].slice.call(arguments,1,arguments.length))},x.next_video=function(t){if(!x.is_ended(t)||0!=(t.mode&A.LOOP))return t.members[x.next_id(t)]},x.prev_video=function(t){if(0!==t.idx||0!=(t.mode&A.LOOP))return t.members[x.prev_id(t)]},x.current_video=function(t){return-1==t.idx?t.members[0]:t.members[t.idx]},x.next_id=function(t){var e=t.idx+1;return e>t.last_idx?0:e},x.prev_id=function(t){var e=t.idx-1;return e<0?t.last_idx:e},x.lpop=function(t){return++t.idx,t.members[t.idx]},x._sort=function(t,e){return(e&A.SHUFFLE)==A.SHUFFLE?t.sort((function(){return Math.random()-Math.random()})):t.slice(0)},x.reset=function(t){return new x(t.members,{mode:t.mode,plays:t.plays+1,sort:t.sort})},x.of=function(t,e){var n=e.shuffle?A.SHUFFLE:A.FIFO;return e.loop&&(n|=A.LOOP),new x(t,{mode:n,sort:e.sort})};var I={PLAYLIST_NEXT:"playlist:next",PLAYLIST_PREVIOUS:"playlist:previous",PLAYLIST_LOOP:"playlist:loop",PLAYLIST_ENDED:"playlist:ended",PLAYLIST_READY:"playlist:ready",PLAYLIST_INTERSTITIAL:"playlist:interstitial",PLAYLIST_INTERSTITIAL_END:"playlist:interstitial_end"},E="is-starting",S="is-seamless";function T(t){return"function"==typeof t}function P(){throw new Error("Function was expected as Argument[0]")}var q=[].slice;function k(t){if(!(this instanceof k))return new k(t);var e=this;return e.data=t,e.tap=function(){var t=q.call(arguments),n=t.shift();return n==k.lift?e.data:T(n)?(n.apply(e,[e.data].concat(t)),e):void P()},e.into=e.fmap=function(){var t=q.call(arguments),n=t.shift();return n==k.lift?e.data:T(n)?k(n.apply(e,[e.data].concat(t))):void P()},e.unwrap=function(){return e.data},e}function C(t){return"invalid playlist configuration\ndetails: "+t+"\n\tmust match Object of shape:\n"+["\t\t{ controls?: Selector|HTMLElement","player:    Selector|HTMLElement","playlist:  PlaylistId|Array(MediaId|PlayerConfig)","shuffle?:  Boolean|false","loop?:     Boolean|false","advance?:  Boolean|true","delay?:    Milliseconds|5000"].join("\n\t\t, ")+"\n\t\t}"}function O(t,e){k.of(t).fmap(C).fmap(L,e)}function N(t){return void 0!==t}function Y(t){return"string"==typeof t}function j(t){return"object"==typeof t}function D(t){try{return t instanceof HTMLElement}catch(e){return j(t)&&j(t.style)&&j(t.ownerDocument)}}function M(t){var e;O("Config must be an Object",N(t)&&j(t)),O("property `playlist` is required",N(t.playlist)),O("property `playlist` was not a String(MediaId)",Y(t.playlist)||(e=t.playlist,O("playlist property was not of type PlaylistId|Array(MediaId|PlayConfig)",Array.isArray(e)),O("playlist property cannot be an empty Array",e.length>0),!e.forEach((function(t,e){O("item at playlist["+e+"] was not valid",Y(t)||j(t))})))),"loop shuffle".split(" ").forEach((function(e){N(t[e])&&O(e+" must be a boolean value if present","boolean"==typeof t[e])})),N(t.delay)&&O("property `delay` must be a Number (Milliseconds)","number"==typeof t.delay)}function F(t,e,n){var r=x.lpop(e),i=e.idx+e.plays<1;return function(t,e,n){"object"==typeof e&&t.setOpts(e);R(t,e,n)}(t,r,n),i&&n.autoplay?t.togglePlay(!0):i?t.setState(E,!0):!i&&n.advance?B(t,n,(function(){t.paused&&(t.setState(S,!0),t.togglePlay(!0))})):void t.emit(I.PLAYLIST_INTERSTITIAL,{config:n})}function R(t,e,n){if(t.setSrc(Y(e)||e.type?e:e.src),t.emit(I.PLAYLIST_NEXT,e),u(n,"should_play",!1))return t.play()}function H(t,e){e=t.playlist.queue=x.reset(e),t.emit(I.PLAYLIST_READY,{queue:e,should_play:!1})}function B(t,e,n){var r=setTimeout(n,e.delay||0);e.delay>0&&t.emit(I.PLAYLIST_INTERSTITIAL,{timer:r,config:e})}function U(t,e,n){if(e[t])return(n=n||[]).unshift(w.span({innerText:e[t]})),w.div({class:t},n)}k.of=k,k.lift=function(t){return t instanceof k?t.data:t},k._apply=k.apply=function(t,e){if(0==e.length)return t();if(1==e.length)return t(e[0]);if(2==e.length)return t(e[0],e[1]);if(3==e.length)return t(e[0],e[1],e[2]);if(4==e.length)return t(e[0],e[1],e[2],e[3]);if(5==e.length)return t(e[0],e[1],e[2],e[3],e[4]);throw new Error("Pipe._apply() does not support arity > 5")},k.maybe=function(t,e,n){return t?k._apply(e,[t].concat(q.call(arguments,2,arguments.length))):t},k.curry=function(t,e,n){return(e=e||[]).length>t.length-1?t.apply(n,e):function(){var r=e.concat(q.call(arguments));return k.curry(t,r,n)}};var X={coords:"0 0 41 42",link:"#fp-skip-next",translation_key:"core.skip-next",name:"fp-skip-next"},V={coords:"0 0 41 42",link:"#fp-skip-prev",translation_key:"core.skip-prev",name:"fp-skip-prev"};function W(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Q(t){var e,n,r=W("svg");return r.setAttribute("viewBox",t.coords),t.name&&r.setAttribute("class",t.name),t.title&&r.setAttribute("title",t.title),t.title&&r.setAttribute("aria-label",t.title),r.setAttribute("tabindex","0"),r.setAttribute("focusable","true"),r.appendChild((e=t.link,(n=W("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),n)),w(r)}function z(t,n,o){w(t),t.addClass("fp-playlist-controls "+(o.theme||"fp-dark")),n.setState("is-playlist",!0);var l=n.root.className.split(" ").filter((function(t){return t.match(/^use-play/)})).pop();if(l&&t.addClass(l),n.on([I.PLAYLIST_NEXT,i,r,I.PLAYLIST_READY],(function(e){var r=u(e,"data.queue",u(n,"playlist.queue"));if(r&&(new G(t,r,n),n.root.controls.btns.toggleClass("is-prev-button-disabled",!r.idx),n.root.controls.btns.toggleClass("is-next-button-disabled",r.idx===r.last_idx),n.skip_controls)){var i=r.idx<r.last_idx?x.next_video(r):null,o=r.idx>0?x.prev_video(r):null;n.skip_controls.nextPreview.style.backgroundImage=["url(",i?i.poster:null,")"].join(""),n.skip_controls.prevPreview.style.backgroundImage=["url(",o?o.poster:null,")"].join("")}})),o.skip_controls&&!n.skip_controls){var s=function(t){var n=Q(V).attr("role","button");n.on(e,(function(){t.playlist.prev()}));var r=Q(X).attr("role","button");r.on(e,(function(){t.playlist.next()}));var i=w.div("fp-playlist-prev-preview"),o=w.div("fp-playlist-next-preview");return t.root.controls.btns.prepend(n),t.root.controls.btns.append(r),t.root.controls.btns.append(i),t.root.controls.btns.append(o),{prevButton:n,nextButton:r,prevPreview:i,nextPreview:o}}(n);n.reaper.put("skip_controls",s),n.on(a,(function(){for(var t in s)s[t]=0}))}}function G(t,e,n){t.empty();var r=t.append(w.ol("fp-playlist"));x.map(e,(function(t,i){var o=J(t,e,n,i);o&&r.append(o)}))}function J(t,e,n,r){if(t.title){var i={class:r==e.idx?"is-current "+function(t){return t.paused?"is-paused":"is-playing"}(n):"is-queued",onclick:J.onclick.bind(null,t,e,n,r)};return w.li(i,[w.div("fp-color"),K(t),Z(t,n)])}}function K(t){return w.div("video-info",[U("title",t),U("description",t)])}function Z(t,e){var n=w.div("video-buttons",e.root.ui.findAll(".fp-switch").map((function(t){return w(t.cloneNode(!0)).removeClass("fp-switch")})));return t.poster&&(n.style.backgroundImage=["url(",t.poster,")"].join("")),n}J.onclick=function(t,e,n,r){return e.idx!=r||n.paused?e.idx==r&&n.paused?n.play():(e.idx=r,void R(n,t,{should_play:!0})):n.pause()};function $(t){return Math.min(100*t,100)+"%"}function tt(t,e){var n=w.div("fp-interstitial"),r=t.root.ui.find(".fp-middle");r.append(n),t.on(I.PLAYLIST_INTERSTITIAL,(function(i){var o=i.data;t.setState("is-interstitial",!0);var a=x.current_video(t.playlist.queue);a&&(n.empty().append(tt.Innards(t,a,r,o)),e.advance&&tt.animate_countdown(t,o,n.querySelector(".countdown")))})),t.on("src playing waiting",(function(){t.emit(I.PLAYLIST_INTERSTITIAL_END)})),t.on(I.PLAYLIST_INTERSTITIAL_END,(function(){t.setState("is-interstitial",!1)}))}tt.animate_countdown=function(t,e,n){if(!n)throw new Error("no element to animate was passed");var r=e.config.delay,i=Date.now()+r,o=Date.now(),a=Math.ceil(1e3/60);!function l(){var s=Date.now();if(!(s>i)&&t.paused){if(!e.timer)return n.css({width:$(0)});requestAnimationFrame(l),s-o<a||(o=s,n.css({width:$(1-(i-s)/r)}))}}()},tt.Innards=function(t,e,n,r){var i=w.div("left",n.findAll(".fp-switch").map((function(t){return w(t.cloneNode(!0)).removeClass("fp-switch")})));return e.poster&&(i.style.backgroundImage=["url(",e.poster,")"].join("")),[i,w.div("right",[w.div("up-next",[w.span().txt(t._t("playlist.up_next")),w.div("fp-color countdown")]),U("title",e),U("description",e),r.timer&&w.div({class:"cancel",onclick:function(t){return clearTimeout(r.timer),r.timer=0,w(t.target).remove(),t.preventDefault(),!1}},[w.span().txt(t._t("playlist.cancel"))])])]};var et=["playlist","controls","shuffle","loop","advance","delay","player","skip_controls"],nt=["src"];function rt(t){M(t)}function it(t,e){var n=this;n.queue=e,n.play=function(e){n.queue.idx=e,R(t,x.current_video(n.queue),{should_play:!0})},n.next=function(){n.queue.idx!==n.queue.last_idx&&n.play(n.queue.idx+1)},n.prev=function(){n.queue.idx&&n.play(n.queue.idx-1)},n.remove=function(e){n.queue.members[e]&&(n.queue.members.splice(e,1),n.queue.plays--,H(t,n.queue))},n.push=function(e){n.queue.members=n.queue.members.concat(e),n.queue.plays--,H(t,n.queue)},n.clear=function(){n.queue.members=[],n.queue.plays--,H(t,n.queue)}}function ot(t,e){e.delay="delay"in e?e.delay:1e4,rt(e);const n=function(t){var e={};for(var n in nt.forEach((function(e){e in t&&(console.warn(new Error("unsupported attribute: "+e+" found on the top-level config")),delete t[e])})),t)~et.indexOf(n)||(e[n]=t[n]);return e}(e);e=function(t,e){var n={};for(var r in t)et.indexOf(r)<0||(n[r]=t[r]);for(r in e)et.indexOf(r)<0||(n[r]=e[r]);return n}((t=flowplayer(t,n)).opts,e),new tt(t,e);var r=ot.make_controls(t,e);return ot.attach_events(t,r,e),ot.fetch(e,(function(e){t.emit(I.PLAYLIST_READY,{queue:e,should_play:0===t.currentSrc.length})})),t}function at(t){return"invalid recommendations configuration\ndetails: "+t+"\n\tmust match Object of shape:\n"+["\t\t{ playlist:  PlaylistId|Array(MediaId|PlayerConfig)"].join("\n\t\t, ")+"\n\t\t}"}function lt(t,e){k.of(t).fmap(at).fmap(L,e)}function st(t){return void 0!==t}function ut(t){return"string"==typeof t}function ct(t){return"object"==typeof t}function ft(t){var e;lt("Config must be an Object",st(t)&&ct(t)),lt("property `playlist` is required",st(t.playlist)),lt("property `playlist` was not an array nor playlist id",(e=t.playlist,lt("playlist property was not of type PlaylistId|Array(MediaId|PlayConfig)",Array.isArray(e)),!e.forEach((function(t,e){lt("item at playlist["+e+"] was not valid",ut(t)||ct(t))}))))}function pt(t,e){var n=function(t,e){var n=w.div({class:"fp-endscreen-cell-thumbnail",onclick:pt.onclick.bind(null,t,e)});t.poster&&(n.style.backgroundImage=["url(",t.poster,")"].join(""));return n}(t,e);return n.append(function(t){var e=t.title||"";return w.div("fp-endscreen-cell-title",e)}(t)),n}ot.make_controls=function(t,e){var n=ot.cast_controls(e);if(n)return w(n),new z(n,t,e),n},ot.cast_controls=function(t){var e,n;if(Y(n=t.controls)||D(n))return D(t.controls)?e=t.controls:Y(t.controls)&&(e=document.querySelector(t.controls)),L("Count not find controls by Selector["+t.controls+"]",D(e)),e},ot.fetch=function(t,e){if(Array.isArray(t.playlist))return e(x.of(t.playlist,t));throw new Error("config.playlist must be an Array")},ot.attach_events=function(t,e,n){t.on(I.PLAYLIST_READY,(function(e){var r=e.data.queue,i=e.data.should_play;t.reaper.put("playlist",new it(t,r)),i&&F(t,r,n)})),t.on(o,(function(){if(x.is_ended(t.playlist.queue))return function(t,e){t.emit(I.PLAYLIST_ENDED),e.loop&&(t.playlist.queue=x.reset(t.playlist.queue),t.emit(I.PLAYLIST_LOOP),B(t,e,(function(){t.emit(I.PLAYLIST_READY,{queue:t.playlist.queue,should_play:!0})})))}(t,n);0!=n.advance&&F(t,t.playlist.queue,n)}))},ot.events=I,ot.VideoQueue=x,pt.onclick=function(t,e){"object"==typeof t&&e.setOpts(t),function(t,e,n){if(t.setSrc(ut(e)?e:e.src),u(n,"should_play",!1))t.play()}(e,t,{should_play:!0})};function dt(e,r,a){var s=w.div("fp-endscreen");a.reaper.put("endscreen",s),a.on(t,(function(){a.root.middle.append(s)})),a.on(l,(function(t){var n=t.data;ft(n),s.recommendations=n,!a.ended||a.playlist||e.loop||yt(r,s,a)})),a.on(o,(function(t){setTimeout((function(){if(s.recommendations&&!a.playlist){if(t.defaultPrevented)return;yt(r,s,a)}}),0)})),a.on(ot.events.PLAYLIST_ENDED,(function(){s.recommendations&&!e.loop&&yt(r,s,a)})),a.on([n,i],(function(){a.setState("is-endscreen",!1)}))}function yt(t,e,n){e.empty();var r=e.recommendations;if(r.playlist&&0!==r.playlist.length){var i=t.hasClass("is-small")||t.hasClass("is-tiny")?6:12,o=[];r.playlist.forEach((function(t,e){o.length!==i&&t.poster&&t.title&&o.push(w.div("fp-endscreen-cell",new pt(t,n,e)))})),0!==o.length&&(e.append(w.div("fp-endscreen-cells",o)),n.setState("is-endscreen",!0))}}return function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});var n=t.flowplayer;"function"==typeof n?n(e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e))}(window,dt),dt}));
