!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.subtitles=e())}(this,(function(){"use strict";var t=[].slice;function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e,n){for(e=function(t){return Array.isArray(t)?t.slice(0):t.split(".")}(e);e.length;){if(null==t)return n;t=t[e.shift()]}return null==t?n:t}function r(e){return t.call(e)}var i=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},o=["touchstart","touchmove"];function a(t){return t.emit=function(n,r,i){i=i||{};var o=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(n);return r&&e(o,{data:r||{}}),t.dispatchEvent(o),!1===i.return_self?o:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~o.indexOf(t)}(e)?t.addEventListener(e,n,i):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(i){t.off(e,r),n(i)}))},t}var c=Array.isArray,s="undefined"!=typeof window&&a(window),u="undefined"!=typeof document&&a(document),f=["span","a","em","p","i"],l=f.concat(["div","strong","video","img","ol","ul","li","script"]);function d(t,e,n){var r=p(document.createElement(t));if(c(e)&&(n=e,e=!1),c(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var i in e)i in r?r[i]=e[i]:r.setAttribute(i,e[i]);return r}function p(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:function(t){var e=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?p(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var n=t.insert=function(e,n){return c(n)?n.map((function(n){return t.insert(e,n)}))[0]:p(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=n.bind(t,"beforeend"),t.prepend=n.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~f.indexOf(e)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(e){return r(t.querySelectorAll(e))},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}(a(t))}function m(t,e){if("string"==typeof t&&"<"==t[0])return d(t.slice(1,-1),e);if("string"!=typeof t)return p(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?p(n):void 0}m.window=s,m.document=u,m.el=d,l.forEach((function(t){m[t]=function(e,n){return"string"==typeof e&&(e={class:e}),d(t,e,n)}}));var v="mount",h="click",g="mouseleave",y="state",x="config";function _(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function b(t){var e,n,r=_("svg");return r.setAttribute("viewBox",t.coords),t.name&&r.setAttribute("class",t.name),t.title&&r.setAttribute("title",t.title),t.title&&r.setAttribute("aria-label",t.title),r.setAttribute("tabindex","0"),r.setAttribute("focusable","true"),r.appendChild((e=t.link,(n=_("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),n)),m(r)}var k={TOGGLE_OPEN:"menu:toggle:open",RENDER:"menu:render",PUSH:"menu:push"},w={ON:"fp-on",INVIS:"fp-invis"};function E(n,r,i){var o=i.id||"menu-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);return i=i||{},n.attr("role","button").attr("aria-haspopup","true").attr("aria-expanded","false").attr("aria-controls",o).attr("aria-label",i.title),i.options=i.options||[],i.id=o,E._interface(n,r,function(){var n=t.call(arguments),r=n.shift();return n.reduce(e,r)}({},i))}function C(t){return"function"==typeof t}function O(){throw new Error("Function was expected as Argument[0]")}E.title=function(t){return m("<h3>").txt(t)},E.close=function(t){return m.span("fp-close").on(h,t).html("&times;")},E.option=function(t,e){var n=this,r=m("<li>").attr("tabindex","0").attr("role","menuitem"),i=n._attrs;t.icon&&r.append(b(t.icon)),r.append(m("<span>").txt(t.text)),r.on(h,(function(r){i.multi||n.options().forEach(E.off),n.activate(e),"function"==typeof t.onclick&&t.onclick(r,t,e,n)})),r.idx=e,n.append(r)},E._interface=function(t,e,r){t.addClass("fp-menu-container");var i=m("<ul>").attr("id",r.id).addClass("fp-menu").attr("role","menu");return r.icons&&i.addClass("fp-icons"),i._attrs=r,t.on(h,(function(t){setTimeout((function(){if(!t.defaultPrevented)return i.hasClass(w.ON)?e.emit(k.TOGGLE_OPEN,{menu:i,open:!1}):void e.emit(k.TOGGLE_OPEN,{menu:i,open:!0})}),0)})),i.on(g,(function(){e.emit(k.TOGGLE_OPEN,{menu:i,open:!1})})),e.on(k.TOGGLE_OPEN,(function(r){if(n(r,"data.menu")!==i)return i.toggleClass(w.ON,!1),t.attr("aria-expanded","false");var o=n(r,"data.open",!1);if(i.toggleClass(w.ON,o),t.attr("aria-expanded",o?"true":"false"),e.hasClass("is-accessibility"))if(o){var a=i.options()[0];a&&a.focus()}else t.focus()})),i.push=function(t){return i._attrs.options=n(i,"_attrs.options",[]),i._attrs.options.push(t),i.render()},i.select=function(t){return i.render(i.options.filter(t))},i.render=function(e){var n=i._attrs;return i.empty(),i.prepend(E.close()),n.title&&i.prepend(E.title(n.title)),n.options=e||n.options,n.options.forEach(E.option,i),t.toggleClass(w.INVIS,0==n.options.length),i._activate(),i},i.close=function(){i.hasClass(w.ON)&&e.emit(k.TOGGLE_OPEN,{menu:i,open:!1})},i._activate=function(){i.options().forEach((function(t){t.toggleClass(w.ON,t.idx===i.idx)}))},i.options=function(){return[].slice.call(i.querySelectorAll("li"))},i.activate=function(t,e){void 0===i.idx||i.idx!==t||e?i.idx=t:delete i.idx,i._activate()},i.deactivate=function(){i.activate(i.idx)},i.render(r.options),t.appendChild(i),i},E.on=function(t){return t.addClass(w.ON),t},E.off=function(t){return t.removeClass(w.ON),t},E.CONTAINER_CLASS="fp-menu",E.Events=k,E.States=w;var N=[].slice;function A(t){if(!(this instanceof A))return new A(t);var e=this;return e.data=t,e.tap=function(){var t=N.call(arguments),n=t.shift();return n==A.lift?e.data:C(n)?(n.apply(e,[e.data].concat(t)),e):void O()},e.into=e.fmap=function(){var t=N.call(arguments),n=t.shift();return n==A.lift?e.data:C(n)?A(n.apply(e,[e.data].concat(t))):void O()},e.unwrap=function(){return e.data},e}A.of=A,A.lift=function(t){return t instanceof A?t.data:t},A._apply=A.apply=function(t,e){if(0==e.length)return t();if(1==e.length)return t(e[0]);if(2==e.length)return t(e[0],e[1]);if(3==e.length)return t(e[0],e[1],e[2]);if(4==e.length)return t(e[0],e[1],e[2],e[3]);if(5==e.length)return t(e[0],e[1],e[2],e[3],e[4]);throw new Error("Pipe._apply() does not support arity > 5")},A.maybe=function(t,e,n){return t?A._apply(e,[t].concat(N.call(arguments,2,arguments.length))):t},A.curry=function(t,e,n){return(e=e||[]).length>t.length-1?t.apply(n,e):function(){var r=e.concat(N.call(arguments));return A.curry(t,r,n)}};function S(t,e){if(function(t){switch(t){case"":case"anonymous":case"use-credentials":return!0;default:console.warn("Invalid(crossorigin: %s) must be one of '', 'anonymous', or 'use-credentials'\nhttps://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes",t)}}(e=e||"anonymous"),t.crossOrigin!=e)return t.attr("crossorigin",e),t}function T(t){var e=document.createElement("a");return e.href=t,e.origin}function L(t,e){var n=function(t,e){return t.querySelector("track[src='"+e+"']")}(e,t.src);if(n)return n;"string"!=typeof t.crossorigin&&function(t,e){try{return t.src.indexOf("blob:"),T(t.src)!==T(e)}catch(t){return console.error(t),!0}}(e,t.src)&&(S(e),t.crossorigin=e.attr("crossorigin")),"crossorigin"in t&&S(e,t.crossorigin),"object"==typeof t&&1==t.is_default&&(delete t.is_default,t.default=!0),t.default||delete t.default,t.id=t.id||[t.srclang,t.label,t.lang].filter((function(t){return!!t})).join("-");var r=m("<track>",t);return e.append(r),r}function P(t,e){return{text:t.label,track:t,onclick:G.bind(0,e)}}function G(t,e,n,r,i){[].forEach.call(t.textTracks,(function(e){return"showing"==e.mode&&n.track==e?(i.deactivate(r,!1),t.emit("tracks:text:updated"),e.mode="disabled"):e==n.track?(i.activate(r,!0),t.emit("tracks:text:updated",e),e.mode="showing"):void(e.mode="disabled")}))}var j=["subtitles","captions","descriptions"];function q(t){return t.filter((function(t){return t&&~j.indexOf(t.kind)}))}function H(t){var e=document.createElement("a");return e.href=t,e}var I="is-playing";function M(t,e){return 1==t.filter((function(t){return n=t.src,r=e,H(n).href==H(r).href;var n,r})).length}function R(t,e,n){A.of(t).fmap(F,P,n).fmap(e.render),t.forEach((function(t,n){"showing"==t.mode&&e.activate(n)}))}function F(t,e,n,r,i){return t.map((function(t){return e.call(this,t,n,r,i)}))}return function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});var n=t.flowplayer;return"function"==typeof n?(n(e),e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e),e)}(window,(function(t,e,i){var o=m.span("fp-cc fp-menu-container").attr("tabindex","0").txt(i._t("cc.button","CC")),a=E(o,e,{title:i._t("cc.menu_title","Subtitles"),options:[]});i.reaper.put("_tracks",[]),i.reaper.put("_track_elements",[]),o.on("click",(function(t){var e=A.of(i._tracks).fmap(r).fmap(q).fmap(A.lift);1===e.length&&(t.preventDefault(),a.options().shift().emit("click"),function(t,e){e.toggleClass("fp-color-text","showing"==t.mode)}(e[0],o))})),i.on(x,(function(){A.of(t).fmap(n,"subtitles.tracks").tap(A.maybe,(function(t){var e=i._track_elements||[];e.slice(0).forEach((function(n,r){M(t,n.src)||(n.remove(),e.splice(r,1))}))})).tap(A.maybe,(function(t){return i._track_elements=F(t,L,i),i._track_elements.map((function(t){return t.track}))})).tap(A.maybe,(function(){i._tracks=r(i.textTracks)})).tap(A.maybe,(function(t){i.emit("tracks:text:all",i._tracks),i._tracks.forEach((function(t,e){"showing"==t.mode&&a.activate(e,!0)}))}))})),i.one(v,(function(){if(0!=e.reaper&&(e.controls&&e.controls.append(o),0!=i.textTracks.length)){var t=r(i.textTracks);i.emit("tracks:text:all",t)}})),i.textTracks.addEventListener("addtrack",(function(){i.hls||i.emit("tracks:text:all",r(i.textTracks))})),i.textTracks.addEventListener("removetrack",(function(){i.hls||i.emit("tracks:text:all",r(i.textTracks))})),i.on("tracks:text:all",(function(t){i._tracks=n(t,"data",[]),function(t,e,n,i){var o=A.of(t).fmap(r).fmap(q).tap(R,n,e).fmap(A.lift);1==o.length&&i.toggleClass("fp-color-text","showing"==o[0].mode)}(i._tracks,i,a,o)})),i.on("tracks:text:change",(function(t){"number"==typeof t.data&&a.activate(t.data)})),i.on(y,(function(t){i.hasState("is-touched")||i.hasState("is-hovered")||!i.hasState(I)||a.close()}))}))}));
