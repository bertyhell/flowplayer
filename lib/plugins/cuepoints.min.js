!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((n=n||self).flowplayer=n.flowplayer||{},n.flowplayer.cuepoints=e())}(this,(function(){"use strict";var n="durationchange",e="cuepoints",t="cuepointstart",r="cuepointend",i="config";var o=[].slice;function u(n,e){for(var t in e)n[t]=e[t];return n}function a(n,e,t){for(e=function(n){return Array.isArray(n)?n.slice(0):n.split(".")}(e);e.length;){if(null==n)return t;n=n[e.shift()]}return null==n?t:n}var f=!!function(){var n=!1;try{var e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(n){}return n}()&&{passive:!0},c=["touchstart","touchmove"];function s(n){return n.emit=function(e,t,r){r=r||{};var i=function(n){var e=document.createEvent("Event");return e.initEvent(n,!1,!0),e}(e);return t&&u(i,{data:t||{}}),n.dispatchEvent(i),!1===r.return_self?i:n},n.on=function(e,t){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(n){return~c.indexOf(n)}(e)?n.addEventListener(e,t,f):n.addEventListener(e,t)})),n},n.off=function(e,t){return n.removeEventListener(e,t),n},n.one=n.once=function(e,t){return n.on(e,(function r(i){n.off(e,r),t(i)}))},n}var d=Array.isArray,l="undefined"!=typeof window&&s(window),p="undefined"!=typeof document&&s(document),v=["span","a","em","p","i"],m=v.concat(["div","strong","video","img","ol","ul","li","script"]);function y(n,e,t){var r=w(document.createElement(n));if(d(e)&&(t=e,e=!1),d(t)||(t=[t]),r.append(t.filter((function(n){return n}))),"object"!=typeof e)return r;for(var i in e)i in r?r[i]=e[i]:r.setAttribute(i,e[i]);return r}function h(n){var e=n.tagName;n.__flowplayer__=1,n.find=function(e){var t=n.querySelector(e);return t?w(t):t},n.html=function(e){return n.innerHTML=e,n},n.empty=function(){return n.innerHTML="",n},n.offset=function(){var e={top:0,left:0},t=n;do{e.left+=t.offsetLeft||0,e.top+=t.offsetTop||0}while(t=t.offsetParent);return e},n.innerWidth=function(){var e=getComputedStyle(n);return n.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var t=n.insert=function(e,t){return d(t)?t.map((function(t){return n.insert(e,t)}))[0]:w(t="string"==typeof t?n.insertAdjacentHTML(e,t):n.insertAdjacentElement?n.insertAdjacentElement(e,t):n.appendChild(t))};return n.append=t.bind(n,"beforeend"),n.prepend=t.bind(n,"afterbegin"),n.css=function(e,t){if("object"==typeof e){for(var r in e)n.css(r,e[r]);return n}return void 0===t?getComputedStyle(n)[e]:(1*t&&(t+="px"),n.style[e]=t,n)},n.show=function(){return n.css({display:~v.indexOf(e)?"inline":"block"})},n.hide=function(){return n.css({display:"none"})},n.remove=function(){var e=n.parentNode;e&&e.removeChild(n)},n.attr=function(e,t){return null==t?n.getAttribute(e):(n.setAttribute(e,t),n)},n.txt=function(e){return n.textContent=e,n},n.fp=function(e){return n.addClass("fp-"+e)},n.addClass=function(e){return e.split(" ").forEach((function(e){n.hasClass(e)||(n.className+=(n.className?" ":"")+e)})),n},n.removeClass=function(e){e=e.split(" ");var t=n.className.split(" ");return n.className=t.filter((function(n){return!~e.indexOf(n)})).join(" "),n},n.toggleClass=function(e,t){return void 0===t&&(t=!n.hasClass(e)),t?n.addClass(e):n.removeClass(e)},n.findAll=function(e){return t=n.querySelectorAll(e),o.call(t);var t},n.hasClass=function(e){return~n.className.split(" ").indexOf(e)},n}function w(n){return void 0===n||function(n){return n&&n.__flowplayer__}(n)?n:h(s(n))}function g(n,e){if("string"==typeof n&&"<"==n[0])return y(n.slice(1,-1),e);if("string"!=typeof n)return w(n);var t=e instanceof HTMLElement&&e.querySelector(".fp-"+n)||document.querySelector(n);return t?w(t):void 0}g.window=l,g.document=p,g.el=y,m.forEach((function(n){g[n]=function(e,t){return"string"==typeof e&&(e={class:e}),y(n,e,t)}}));var x=window.VTTCue||window.TextTrackCue;function C(n,e,i){var a=n.startTime||n.start,f=n.endTime||n.end,c=n.text||"";try{var s=new x(a,f,c);return function(){var n=o.call(arguments),e=n.shift();n.reduce(u,e)}(s,{id:e.toString()},n),s.onenter=i.emit.bind(i,t,{cuepoint:n}),s.onexit=i.emit.bind(i,r,{cuepoint:n}),s}catch(n){if(a===f)return console.warn("Cue(:error)> startTime cannot equal endTime on this platform");throw n}}function T(n,e){n.cues&&n.cues.length&&[].slice.call(n.cues).forEach(e)}return function(n,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in n||(n.flowplayer={extensions:[]});var t=n.flowplayer;return"function"==typeof t?(t(e),e):(Array.isArray(t.extensions)||(t.extensions=[]),~t.extensions.indexOf(e)||t.extensions.push(e),e)}(window,(function(t,r,o){var u=o.addTextTrack("metadata","fp-cuepoints");o.reaper.put("cuepoints",[]),o.on(i,(function(n){a(n,"data.cuepoints",[])!==o.cuepoints&&o.emit(e,{cuepoints:t.cuepoints})})),o.on(["cuepoints:redraw",n],(function(){t.draw_cuepoints&&r.timeline&&function(n,e,t){if(n){var r=e.duration;if(isFinite(r))n.findAll(".fp-cuepoint").forEach((function(n){n.remove()})),T(t,(function(e,t){var i=Math.round(e.startTime/r*1e3)/10,o=g.span("fp-cuepoint");if(i>100||i<0)return console.warn("Cuepoint("+t+") does not have a valid startTime("+e.startTime+") ");o.css("left",i+"%");var u=(e.endTime-e.startTime)/r*100;o.css("width",u+"%"),n.append(o)}))}}(r.timeline,o,u)})),o.on(e,(function(n){var e=a(n,"data.cuepoints",[]);o.reaper.put("cuepoints",e),T(u,(function(n){n&&u.removeCue(n)})),e.map((function(n,e){return C(n,"cuepoint-"+e,o)})).forEach((function(n){u.addCue(n)})),o.emit("cuepoints:redraw")}))}))}));
