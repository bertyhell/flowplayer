!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((e=e||self).flowplayer=e.flowplayer||{},e.flowplayer.qul=n())}(this,(function(){"use strict";var e=[].slice;function n(e,n,t){for(n=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(n);n.length;){if(null==e)return t;e=e[n.shift()]}return null==e?t:e}var t="error",r="src",i="reap",o="config",u="is-error",a=!!function(){var e=!1;try{var n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,n),window.removeEventListener("testPassive",null,n)}catch(e){}return e}()&&{passive:!0},s=["touchstart","touchmove"];function f(e){return e.emit=function(n,t,r){r=r||{};var i=function(e){var n=document.createEvent("Event");return n.initEvent(e,!1,!0),n}(n);return t&&function(e,n){for(var t in n)e[t]=n[t]}(i,{data:t||{}}),e.dispatchEvent(i),!1===r.return_self?i:e},e.on=function(n,t){return"string"==typeof n&&(n=n.split(" ")),n.forEach((function(n){return function(e){return~s.indexOf(e)}(n)?e.addEventListener(n,t,a):e.addEventListener(n,t)})),e},e.off=function(n,t){return e.removeEventListener(n,t),e},e.one=e.once=function(n,t){return e.on(n,(function r(i){e.off(n,r),t(i)}))},e}var c=Array.isArray,l="undefined"!=typeof window&&f(window),d="undefined"!=typeof document&&f(document),p=["span","a","em","p","i"],v=p.concat(["div","strong","video","img","ol","ul","li","script"]);function m(e,n,t){var r=h(document.createElement(e));if(c(n)&&(t=n,n=!1),c(t)||(t=[t]),r.append(t.filter((function(e){return e}))),"object"!=typeof n)return r;for(var i in n)i in r?r[i]=n[i]:r.setAttribute(i,n[i]);return r}function y(n){var t=n.tagName;n.__flowplayer__=1,n.find=function(e){var t=n.querySelector(e);return t?h(t):t},n.html=function(e){return n.innerHTML=e,n},n.empty=function(){return n.innerHTML="",n},n.offset=function(){var e={top:0,left:0},t=n;do{e.left+=t.offsetLeft||0,e.top+=t.offsetTop||0}while(t=t.offsetParent);return e},n.innerWidth=function(){var e=getComputedStyle(n);return n.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=n.insert=function(e,t){return c(t)?t.map((function(t){return n.insert(e,t)}))[0]:h(t="string"==typeof t?n.insertAdjacentHTML(e,t):n.insertAdjacentElement?n.insertAdjacentElement(e,t):n.appendChild(t))};return n.append=r.bind(n,"beforeend"),n.prepend=r.bind(n,"afterbegin"),n.css=function(e,t){if("object"==typeof e){for(var r in e)n.css(r,e[r]);return n}return void 0===t?getComputedStyle(n)[e]:(1*t&&(t+="px"),n.style[e]=t,n)},n.show=function(){return n.css({display:~p.indexOf(t)?"inline":"block"})},n.hide=function(){return n.css({display:"none"})},n.remove=function(){var e=n.parentNode;e&&e.removeChild(n)},n.attr=function(e,t){return null==t?n.getAttribute(e):(n.setAttribute(e,t),n)},n.txt=function(e){return n.textContent=e,n},n.fp=function(e){return n.addClass("fp-"+e)},n.addClass=function(e){return e.split(" ").forEach((function(e){n.hasClass(e)||(n.className+=(n.className?" ":"")+e)})),n},n.removeClass=function(e){e=e.split(" ");var t=n.className.split(" ");return n.className=t.filter((function(n){return!~e.indexOf(n)})).join(" "),n},n.toggleClass=function(e,t){return void 0===t&&(t=!n.hasClass(e)),t?n.addClass(e):n.removeClass(e)},n.findAll=function(t){return r=n.querySelectorAll(t),e.call(r);var r},n.hasClass=function(e){return~n.className.split(" ").indexOf(e)},n}function h(e){return void 0===e||function(e){return e&&e.__flowplayer__}(e)?e:y(f(e))}function g(e,n){if("string"==typeof e&&"<"==e[0])return m(e.slice(1,-1),n);if("string"!=typeof e)return h(e);var t=n instanceof HTMLElement&&n.querySelector(".fp-"+e)||document.querySelector(e);return t?h(t):void 0}g.window=l,g.document=d,g.el=m,v.forEach((function(e){g[e]=function(n,t){return"string"==typeof n&&(n={class:n}),m(e,n,t)}}));function w(e,n){n.id&&clearInterval(n.id)}function x(e,n){E(e.original_src,(function(r,i,o){if(200!=i)return w(0,n),r?e.emit(t,r):e.emit(t,{code:i,resp:o})}))}function E(e,n){var t=new XMLHttpRequest;t.onload=function(){if(200==t.status)return n(null,t.status);try{var e=JSON.parse(t.responseText);n(null,"qul:"+t.status,e)}catch(e){n(e)}},t.open("GET",e),t.send()}function C(e,n){var t=document.createElement("a");return t.href=e,[t.protocol,"//",t.hostname,t.pathname.replace(q(t.pathname,0),encodeURIComponent(n)+"/"+q(t.pathname,0))].join("")}function b(e,a,s){var f,c=n(e,"qul.token"),l={};s.on(r,(function(e){f=n(e.data,"src"),w(0,l),"string"==typeof f&&f.match(/\.m3u8$/)&&c&&(e.data.src=C(f,c),void 0===window.MediaSource&&void 0===window.WebKitMediaSource&&(l=function(e,t){var r={id:void 0,interval:Math.min(2e4,n(t,"qul.interval",2e4))};return e.one(i,(function(){w(0,r)})),setInterval(x,r.interval,e,r),setTimeout(x,0,e,r),r}(s,s.opts)))})),s.on(o,(function(e){var t=n(e.data,"qul.token");t&&t!==c&&(c=c,s.setSrc({type:"application/x-mpegurl",src:C(f,c)}))})),s.on(t,(function(e){var t=n(e,"data.code","").toString();if(w(0,l),t.match(/^(qul|http)/)){e.preventDefault(),s.setState(u,!0);var r=n(e,"data.resp");if(r)return A(s,a.ui,r);E(s.original_src,(function(e,n,t){A(s,a.ui,e||t)}))}}))}function A(e,n,t){var r=t.message||"an error occurred during this session",i=t.key?e._t(t.key,r):r;e.pause(),function(e,n,t,r){if(e){var i=g.div("fp-error").txt(n);if(r){var o=e.querySelector("#"+r);o&&e.removeChild(o),i.id=r}e.append(i),t&&i.append(g.div("fp-error-details").txt(t))}}(n,i,!1,"qul_error")}function q(e,n){return e.split("/").reverse().slice(0,n+1).reverse().join("/")}return function(e,n){if("object"==typeof exports&&"undefined"!=typeof module)return n;"flowplayer"in e||(e.flowplayer={extensions:[]});var t=e.flowplayer;"function"==typeof t?t(n):(Array.isArray(t.extensions)||(t.extensions=[]),~t.extensions.indexOf(n)||t.extensions.push(n))}(window,b),b}));
