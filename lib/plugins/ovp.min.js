!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.ovp=e())}(this,(function(){"use strict";var t="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};var e=[].slice;function n(){}function r(t,e){for(var n in e)t[n]=e[n];return t}function o(){var t=e.call(arguments),n=t.shift();return t.reduce(r,n)}function a(t){return Array.isArray(t)?t.slice(0):t.split(".")}function i(t,e,n){for(e=a(e);e.length;){if(null==t)return n;t=t[e.shift()]}return null==t?n:t}function u(t,e,n){var r=(e=a(e)).pop(),o=i(t,e);return o&&(o[r]=n),t}function c(t){return(t=parseInt(t,10))>=10?t:"0"+t}var f="is-starting",s="is-waiting",l="is-seamless",p="error",d="timeupdate",m="config",v="recommendationsready";function y(t){return"function"==typeof t}function _(){throw new Error("Function was expected as Argument[0]")}var h=[].slice;function w(t){if(!(this instanceof w))return new w(t);var e=this;return e.data=t,e.tap=function(){var t=h.call(arguments),n=t.shift();return n==w.lift?e.data:y(n)?(n.apply(e,[e.data].concat(t)),e):void _()},e.into=e.fmap=function(){var t=h.call(arguments),n=t.shift();return n==w.lift?e.data:y(n)?w(n.apply(e,[e.data].concat(t))):void _()},e.unwrap=function(){return e.data},e}w.of=w,w.lift=function(t){return t instanceof w?t.data:t},w._apply=w.apply=function(t,e){if(0==e.length)return t();if(1==e.length)return t(e[0]);if(2==e.length)return t(e[0],e[1]);if(3==e.length)return t(e[0],e[1],e[2]);if(4==e.length)return t(e[0],e[1],e[2],e[3]);if(5==e.length)return t(e[0],e[1],e[2],e[3],e[4]);throw new Error("Pipe._apply() does not support arity > 5")},w.maybe=function(t,e,n){return t?w._apply(e,[t].concat(h.call(arguments,2,arguments.length))):t},w.curry=function(t,e,n){return(e=e||[]).length>t.length-1?t.apply(n,e):function(){var r=e.concat(h.call(arguments));return w.curry(t,r,n)}};var g=[].slice,b=Array.isArray;function E(t){return t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&"[object Date]"!==Object.prototype.toString.call(t)}function O(t,e){return t.length===t.filter(e).length}function j(){return O(g.call(arguments),b)}function A(t,e){for(var n in t)e(n,t[n])}function C(t){return E(t)?b(t)?t.map(C):S({},t):t}function x(t,e){var n={};return A(t,(function(t,e){n[t]=C(e)})),function(t,e){return A(e,(function(e,n){if(void 0===t[e])return t[e]=C(n);t[e]=S(t[e],n)})),t}(n,e)}function S(t,e){return j(t,e)?function(t){return C(t)}(t):!1===t?t:!0===t&&!1!==e||!E(t)&&E(e)?e:void 0===t||E(t)?E(t)&&!E(e)?t:function(){return O(g.call(arguments),E)}(t,e)?x(t,e):void 0:t}function T(){return[].reduce.call(arguments,(function(t,e){return S(t,e)}),j.apply(null,arguments)?[]:{})}function N(){return T.apply(null,g.call(arguments).reverse())}function L(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){try{var t=n.status;if(n.readyState<4)return;if(200!=t&&n.readyState>3&&"function"==typeof e.err){var o={status:t};try{r(o,JSON.parse(n.responseText))}catch(o){}return e.err(o)}e.ok(JSON.parse(n.responseText))}catch(o){console.error(o),e.err(o)}},n.send()}function P(){var t=[].join.call(arguments,"/");return"/"!==t[0]&&(t="/"+t),(flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/native/config"+t}function I(t){return~t.indexOf("/")?t:"/media/"+t}var k={404:"media not found",402:"invalid subscription",400:"bad request",415:"unsupported media type"};var q={media_id:"id",media_duration:"duration",media_name:"title",media_tags:"tags",category:"category_name",ad_keywords:"ad_keywords"};function R(t,e,n){for(var r in n=n||{},t)n[r]=i(e||{},t[r]);return n}var M=["src","metadata","title","description","duration","poster"];function D(t){var e=i(t,"ima.ads");return Array.isArray(e)&&u(t,"ima.ads",e.map((function(e){return"number"==typeof e.percentage&&(e.time=e.percentage*t.duration),e}))),t}function V(t,e){e="object"==typeof e?e:{};var n,r,a={title:i(t,"metadata.title",null),description:i(t,"metadata.description",null)};return N({ima:{parameters:R(q,a)}},a,t,(n=M,r=o({},e),n.forEach((function(t){delete r[t]})),r))}var U=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/;function H(t){return"object"==typeof t&&"ovp/base64"==t.type}function W(t,e,n){return function(t,e){return!(~t.indexOf(".")||!U.test(t))&&(e.type="video/ovp",!0)}(t,e)||H(e)}function F(t){try{return J(decodeURIComponent(atob(t).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return{err:t.message}}}function J(t){return null===t?{}:JSON.parse(t)}var z=Object.freeze({__proto__:null,base64:F,json:J});function Q(t){var e=t.split(/[^0-9]/);return Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5])}var B=Object.freeze({__proto__:null,OVP_ERROR:"ovp:error",OVP_MEDIA_REQUEST_START:"ovp:request:start",OVP_MEDIA_REQUEST_COMPLETE:"ovp:request:media:complete",OVP_PLAYLIST_REQUEST_COMPLETE:"ovp:request:playlist:complete",LIVE_COUNTDOWN_TICK:"ovp:live:countdown:tick",LIVE_COUNTDOWN_START:"ovp:live:countdown:start",LIVE_COUNTDOWN_COMPLETE:"ovp:live:countdown:complete"});function G(t,e){if(H(e))return K(t,e);w(e).fmap(i,"src").fmap(I).fmap(P).fmap(L,{ok:w.curry(X,[t]),err:w.curry(Y,[t])})}function K(t,e){w(e).fmap(i,"src").fmap(w.maybe,F).fmap(w.maybe,w.curry(X,[t]))}function X(t,e){if(i(e,"playlist"))return $(t,e);if(i(e,"live"))return tt(t,e);if(i(e,"src"))return Z(t,e);throw new Error("Status[200] >> unhandled case\n"+JSON.stringify(e,null,2))}function Y(t,e){return e.message?t.emit("ovp:error",e):e.status?t.emit("ovp:error",new Error(k[e.status])):t.emit("ovp:error",e)}function Z(t,e){t.emit("ovp:request:media:complete",w.of(e).fmap(V,t.opts).fmap(D).fmap(w.lift))}function $(t,e){if("function"!=typeof flowplayer.playlist)return console.warn("OVP responded with Playlist media but the playlist plugin does not exist"),Y(t,{status:415});var n,r,a,u;t.emit("ovp:request:playlist:complete",(n=t.opts,r=e,a=o({},n),o(u=N({},r,i(n,"playlist",{})),{playlist:i(u,"playlist",[]).map((function(t){return V(t,a)}))})))}function tt(t,e){var n=i(e,"metadata.live_start_time",i(e,"metadata.starttime"));u(e,"live_start_time",w.of(n).fmap(Q).fmap(w.lift)),t.emit("ovp:live:countdown:start",w.of(e).fmap(V,t.opts).fmap(D).fmap(w.lift))}var et={};function nt(t,e){if("object"==typeof et[e])return console.debug("using Cache(%s)",e),rt(t,e,et[e]);w(e).fmap(P).fmap(L,{ok:w.curry(rt,[t,e]),err:console.error})}function rt(t,e,n){"object"!=typeof et[e]&&(et[e]=n);var r=i(t,"opts",{}),a=i(r,"metadata",{});u(a,"player_id",e),["title","description"].forEach((function(t){!0===n[t]&&"string"==typeof r[t]&&u(n,t,i(r,t))})),u(r,"metadata",a);var c=o(r,n);t.setOpts(c),n.autoplay&&t.togglePlay(!0)}var ot=Object.freeze({__proto__:null,fetch_unknown_media:G,handle_base64:K,handle_200:X,handle_err:Y,handle_single_media:Z,handle_playlist:$,handle_live:tt,fetch_player_id:nt,handle_player_only:rt});function at(t,e,n){w.of("recommendation").fmap(P,e,n).fmap(L,{err:it,ok:w.curry(ut,[t])})}function it(t){console.error("Failed to load recommendations: %j",t)}function ut(t,e){var n=e.playlist;u(t,"opts.recommendations",n),i(n,"length",0)&&t.emit(v,{playlist:n.map((function(t){return{poster:t.poster,src:t.src,title:i(t,"metadata.title"),metadata:t.metadata||{}}}))})}var ct=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},ft=["touchstart","touchmove"];function st(t){return t.emit=function(e,n,o){o=o||{};var a=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(e);return n&&r(a,{data:n||{}}),t.dispatchEvent(a),!1===o.return_self?a:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~ft.indexOf(t)}(e)?t.addEventListener(e,n,ct):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(o){t.off(e,r),n(o)}))},t}var lt=Array.isArray,pt="undefined"!=typeof window&&st(window),dt="undefined"!=typeof document&&st(document),mt=["span","a","em","p","i"],vt=mt.concat(["div","strong","video","img","ol","ul","li","script"]);function yt(t,e,n){var r=ht(document.createElement(t));if(lt(e)&&(n=e,e=!1),lt(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var o in e)o in r?r[o]=e[o]:r.setAttribute(o,e[o]);return r}function _t(t){var n=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?ht(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return lt(n)?n.map((function(n){return t.insert(e,n)}))[0]:ht(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~mt.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(n){return r=t.querySelectorAll(n),e.call(r);var r},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function ht(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:_t(st(t))}function wt(t,e){if("string"==typeof t&&"<"==t[0])return yt(t.slice(1,-1),e);if("string"!=typeof t)return ht(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?ht(n):void 0}function gt(t,e,r){if(!Et(t))return r.emit("ovp:request:media:complete",t);var o=e.append(wt.div({class:"fp-livecountdown"})),a=o.append(wt.div({class:"fp-inner"}));a.append(wt.p({},r._t("ovp.starting_in")));var u=a.append(wt.p({class:"fp-countdown"}));function s(t){var n=i(t,"data.remaining",-1);if(n<0||isNaN(n))return r.emit("ovp:live:countdown:complete");e.addClass("is-livecountdown"),u.txt(function(t){var e=function(t){"number"!=typeof t&&(t=parseInt(t,10)),t=Math.round(t);var e=Math.floor(t/86400);t-=86400*e;var n=Math.floor(t/3600);t-=3600*n;var r=Math.floor(t/60);return{days:e,hours:n,minutes:r,seconds:t-=60*r}}(t),n="";e.days&&(n+=e.days+":");return n+c(e.hours)+":"+c(e.minutes)+":"+c(e.seconds)}(n+1)),r.hasState(f)||r.setState(f,!0)}r.on("ovp:live:countdown:tick",s),r.one("ovp:live:countdown:complete",(function(){o.remove(),e.removeClass("is-livecountdown"),r.off("ovp:live:countdown:tick",s),r.emit("ovp:request:media:complete",t)})),function(t,e){var r,o;function a(){clearInterval(r),clearInterval(o)}function u(){return t=e.live_start_time,n=i(e,"server_time_offset",0),r=Date.now()-n,Math.floor((t-r)/1e3);var t,n,r}function c(){var e=u();if(t.emit("ovp:live:countdown:tick",{remaining:e}),e<0||0===t.reaper)return a()}function f(){var r,o;if(0===u()||0===t.reaper)return a();r=e,o={err:console.error,ok:n},L((flowplayer.OVP_API||"https://ljsp.lwcdn.com")+"/web/public/countdown/time.json",{err:o.err,ok:function(t){var e=Date.now()-t.millisUtc;o.ok(S(r,{server_time_offset:e}))}})}c()&&f(),r=setInterval(c,250),o=setInterval(f,1e4)}(r,t)}function bt(t,e,n){}function Et(t){return t&&t.live_start_time-Date.now()>0}wt.window=pt,wt.document=dt,wt.el=yt,vt.forEach((function(t){wt[t]=function(e,n){return"string"==typeof e&&(e={class:e}),yt(t,e,n)}}));function Ot(t,e,n){var r="flowplayer-ovp-branding-"+e;if(!t.hasClass(r)){!function(t){if(-1==t.className.indexOf("flowplayer-ovp-branding-"))return;t.className=t.className.split(" ").filter((function(t){return-1==t.indexOf("flowplayer-ovp-branding-")})).join(" ")}(t);var o=function(t){if(document.getElementById(t))return!1;var e=document.createElement("style");return e.id=t,e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}(r);o&&(!function(t,e,n,r){if("insertRule"in t)return t.insertRule(e+"{"+n+"}",r);if("addRule"in t)t.addRule(e,n,r)}(o,"."+r+" .fp-color","background-color: #"+n+";"),t.addClass(r))}}function jt(t,e,n,r){if(4==arguments.length&&"object"==typeof r)return"string"!=typeof t.player_id||0===r.src.indexOf(t.player_id)||H(r)||(r.src=[t.player_id,r.src].join("/")),G(n,r);n.on("ovp:error",(function(t){n.emit(p,t.data)})),n.on("ovp:request:start",(function(){n.setState(s,!0),t.recommendations&&(t.recommendations=1)})),n.on("ovp:request:media:complete",(function(t){0==n.reaper||"object"!=typeof t.data||Et(t.data)||(n.setOpts(t.data),n.setAttrs(t.data),n.setSrc(i(t,"data.src")),t.data.autoplay&&n.togglePlay(!0,(function(){setTimeout(n.setState,0,l,!1)})))})),n.on(m,(function(r){var o=i(r,"data.brand_color"),a=i(r,"data.metadata.player_id");if(o&&a&&Ot(e,a,o),!("string"==typeof t.src&&W(t.src,{})||t.src&&t.src.length&&"ovp/base64"===t.src[0].type))return"string"==typeof t.player_id&&i(t,"metadata.player_id")!==t.player_id?nt(n,t.player_id):void 0})),n.on("ovp:request:playlist:complete",(function(t){0!=n.reaper&&"object"==typeof t.data&&flowplayer.playlist(e,t.data)})),n.on("ovp:live:countdown:start",(function(r){0!=n.reaper&&"object"==typeof r.data&&(n.setOpts(r.data),n.setAttrs(r.data),n.render("live/countdown",[t,e,n]))})),n.on(d,(function(){t.live||t.recommendations&&i(t,"metadata.media_id")&&(Array.isArray(t.recommendations)||n.currentTime/n.duration<.8||at(n,i(t,"metadata.media_id"),i(t,"metadata.player_id")))}))}return jt.onumd=function(t){t.components.put("live/countdown",{onrender:gt,onremove:bt})},jt.wants=W,function(t,e){if("object"==typeof exports&&"undefined"!=typeof module)return e;"flowplayer"in t||(t.flowplayer={extensions:[]});var n=t.flowplayer;"function"==typeof n?n(e):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(e)||n.extensions.push(e))}("undefined"!=typeof window?window:void 0!==t?t:{},r(jt,{events:B,Decode:z,Loader:ot})),jt}));
