!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).flowplayer=t.flowplayer||{},t.flowplayer.playlist=e())}(this,(function(){"use strict";var t="click",e="pause",n="playing",r="ended",i="reap",o=[].slice;function a(t,e,n){for(e=function(t){return Array.isArray(t)?t.slice(0):t.split(".")}(e);e.length;){if(null==t)return n;t=t[e.shift()]}return null==t?n:t}var u=!!function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(t){}return t}()&&{passive:!0},l=["touchstart","touchmove"];function s(t){return t.emit=function(e,n,r){r=r||{};var i=function(t){var e=document.createEvent("Event");return e.initEvent(t,!1,!0),e}(e);return n&&function(t,e){for(var n in e)t[n]=e[n]}(i,{data:n||{}}),t.dispatchEvent(i),!1===r.return_self?i:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(t){return~l.indexOf(t)}(e)?t.addEventListener(e,n,u):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(i){t.off(e,r),n(i)}))},t}var c=Array.isArray,f="undefined"!=typeof window&&s(window),p="undefined"!=typeof document&&s(document),d=["span","a","em","p","i"],y=d.concat(["div","strong","video","img","ol","ul","li","script"]);function v(t,e,n){var r=h(document.createElement(t));if(c(e)&&(n=e,e=!1),c(n)||(n=[n]),r.append(n.filter((function(t){return t}))),"object"!=typeof e)return r;for(var i in e)i in r?r[i]=e[i]:r.setAttribute(i,e[i]);return r}function m(t){var e=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?h(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var n=t.insert=function(e,n){return c(n)?n.map((function(n){return t.insert(e,n)}))[0]:h(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n))};return t.append=n.bind(t,"beforeend"),t.prepend=n.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(var r in e)t.css(r,e[r]);return t}return void 0===n?getComputedStyle(t)[e]:(1*n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~d.indexOf(e)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){e=e.split(" ");var n=t.className.split(" ");return t.className=n.filter((function(t){return!~e.indexOf(t)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(e){return n=t.querySelectorAll(e),o.call(n);var n},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function h(t){return void 0===t||function(t){return t&&t.__flowplayer__}(t)?t:m(s(t))}function _(t,e){if("string"==typeof t&&"<"==t[0])return v(t.slice(1,-1),e);if("string"!=typeof t)return h(t);var n=e instanceof HTMLElement&&e.querySelector(".fp-"+t)||document.querySelector(t);return n?h(n):void 0}function b(t,e){if(1!=!!e)throw new Error(t)}function w(t,e){this.mode=e.mode,this.sort=e.sort||w._sort,this.members=this.sort(t.slice(0),e.mode),this.last_idx=this.members.length-1,this.plays=e.plays||0,this.idx=-1}_.window=f,_.document=p,_.el=v,y.forEach((function(t){_[t]=function(e,n){return"string"==typeof e&&(e={class:e}),v(t,e,n)}}));var L=w.modes={SHUFFLE:1,FIFO:2,LOOP:4};w.is_ended=function(t){return t.idx==t.last_idx},w.reduce=function(t,e,n){return t.members.reduce.apply(t.members,[].slice.call(arguments,1,arguments.length))},w.map=function(t,e){return t.members.map.apply(t.members,[].slice.call(arguments,1,arguments.length))},w.next_video=function(t){if(!w.is_ended(t)||0!=(t.mode&L.LOOP))return t.members[w.next_id(t)]},w.prev_video=function(t){if(0!==t.idx||0!=(t.mode&L.LOOP))return t.members[w.prev_id(t)]},w.current_video=function(t){return-1==t.idx?t.members[0]:t.members[t.idx]},w.next_id=function(t){var e=t.idx+1;return e>t.last_idx?0:e},w.prev_id=function(t){var e=t.idx-1;return e<0?t.last_idx:e},w.lpop=function(t){return++t.idx,t.members[t.idx]},w._sort=function(t,e){return(e&L.SHUFFLE)==L.SHUFFLE?t.sort((function(){return Math.random()-Math.random()})):t.slice(0)},w.reset=function(t){return new w(t.members,{mode:t.mode,plays:t.plays+1,sort:t.sort})},w.of=function(t,e){var n=e.shuffle?L.SHUFFLE:L.FIFO;return e.loop&&(n|=L.LOOP),new w(t,{mode:n,sort:e.sort})};var g={PLAYLIST_NEXT:"playlist:next",PLAYLIST_PREVIOUS:"playlist:previous",PLAYLIST_LOOP:"playlist:loop",PLAYLIST_ENDED:"playlist:ended",PLAYLIST_READY:"playlist:ready",PLAYLIST_INTERSTITIAL:"playlist:interstitial",PLAYLIST_INTERSTITIAL_END:"playlist:interstitial_end"},x="is-starting",A="is-seamless";function E(t){return"function"==typeof t}function I(){throw new Error("Function was expected as Argument[0]")}var T=[].slice;function S(t){if(!(this instanceof S))return new S(t);var e=this;return e.data=t,e.tap=function(){var t=T.call(arguments),n=t.shift();return n==S.lift?e.data:E(n)?(n.apply(e,[e.data].concat(t)),e):void I()},e.into=e.fmap=function(){var t=T.call(arguments),n=t.shift();return n==S.lift?e.data:E(n)?S(n.apply(e,[e.data].concat(t))):void I()},e.unwrap=function(){return e.data},e}function P(t){return"invalid playlist configuration\ndetails: "+t+"\n\tmust match Object of shape:\n"+["\t\t{ controls?: Selector|HTMLElement","player:    Selector|HTMLElement","playlist:  PlaylistId|Array(MediaId|PlayerConfig)","shuffle?:  Boolean|false","loop?:     Boolean|false","advance?:  Boolean|true","delay?:    Milliseconds|5000"].join("\n\t\t, ")+"\n\t\t}"}function q(t,e){S.of(t).fmap(P).fmap(b,e)}function k(t){return void 0!==t}function N(t){return"string"==typeof t}function Y(t){return"object"==typeof t}function O(t){try{return t instanceof HTMLElement}catch(e){return Y(t)&&Y(t.style)&&Y(t.ownerDocument)}}function C(t){var e;q("Config must be an Object",k(t)&&Y(t)),q("property `playlist` is required",k(t.playlist)),q("property `playlist` was not a String(MediaId)",N(t.playlist)||(e=t.playlist,q("playlist property was not of type PlaylistId|Array(MediaId|PlayConfig)",Array.isArray(e)),q("playlist property cannot be an empty Array",e.length>0),!e.forEach((function(t,e){q("item at playlist["+e+"] was not valid",N(t)||Y(t))})))),"loop shuffle".split(" ").forEach((function(e){k(t[e])&&q(e+" must be a boolean value if present","boolean"==typeof t[e])})),k(t.delay)&&q("property `delay` must be a Number (Milliseconds)","number"==typeof t.delay)}function D(t,e,n){var r=w.lpop(e),i=e.idx+e.plays<1;return function(t,e,n){"object"==typeof e&&t.setOpts(e);j(t,e,n)}(t,r,n),i&&n.autoplay?t.togglePlay(!0):i?t.setState(x,!0):!i&&n.advance?M(t,n,(function(){t.paused&&(t.setState(A,!0),t.togglePlay(!0))})):void t.emit(g.PLAYLIST_INTERSTITIAL,{config:n})}function j(t,e,n){if(t.setSrc(N(e)||e.type?e:e.src),t.emit(g.PLAYLIST_NEXT,e),a(n,"should_play",!1))return t.play()}function F(t,e){e=t.playlist.queue=w.reset(e),t.emit(g.PLAYLIST_READY,{queue:e,should_play:!1})}function M(t,e,n){var r=setTimeout(n,e.delay||0);e.delay>0&&t.emit(g.PLAYLIST_INTERSTITIAL,{timer:r,config:e})}function R(t,e,n){if(e[t])return(n=n||[]).unshift(_.span({innerText:e[t]})),_.div({class:t},n)}S.of=S,S.lift=function(t){return t instanceof S?t.data:t},S._apply=S.apply=function(t,e){if(0==e.length)return t();if(1==e.length)return t(e[0]);if(2==e.length)return t(e[0],e[1]);if(3==e.length)return t(e[0],e[1],e[2]);if(4==e.length)return t(e[0],e[1],e[2],e[3]);if(5==e.length)return t(e[0],e[1],e[2],e[3],e[4]);throw new Error("Pipe._apply() does not support arity > 5")},S.maybe=function(t,e,n){return t?S._apply(e,[t].concat(T.call(arguments,2,arguments.length))):t},S.curry=function(t,e,n){return(e=e||[]).length>t.length-1?t.apply(n,e):function(){var r=e.concat(T.call(arguments));return S.curry(t,r,n)}};var H={coords:"0 0 41 42",link:"#fp-skip-next",translation_key:"core.skip-next",name:"fp-skip-next"},B={coords:"0 0 41 42",link:"#fp-skip-prev",translation_key:"core.skip-prev",name:"fp-skip-prev"};function U(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function X(t){var e,n,r=U("svg");return r.setAttribute("viewBox",t.coords),t.name&&r.setAttribute("class",t.name),t.title&&r.setAttribute("title",t.title),t.title&&r.setAttribute("aria-label",t.title),r.setAttribute("tabindex","0"),r.setAttribute("focusable","true"),r.appendChild((e=t.link,(n=U("use")).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e),n)),_(r)}function V(r,o,u){_(r),r.addClass("fp-playlist-controls "+(u.theme||"fp-dark")),o.setState("is-playlist",!0);var l=o.root.className.split(" ").filter((function(t){return t.match(/^use-play/)})).pop();if(l&&r.addClass(l),o.on([g.PLAYLIST_NEXT,n,e,g.PLAYLIST_READY],(function(t){var e=a(t,"data.queue",a(o,"playlist.queue"));if(e&&(new W(r,e,o),o.root.controls.btns.toggleClass("is-prev-button-disabled",!e.idx),o.root.controls.btns.toggleClass("is-next-button-disabled",e.idx===e.last_idx),o.skip_controls)){var n=e.idx<e.last_idx?w.next_video(e):null,i=e.idx>0?w.prev_video(e):null;o.skip_controls.nextPreview.style.backgroundImage=["url(",n?n.poster:null,")"].join(""),o.skip_controls.prevPreview.style.backgroundImage=["url(",i?i.poster:null,")"].join("")}})),u.skip_controls&&!o.skip_controls){var s=function(e){var n=X(B).attr("role","button");n.on(t,(function(){e.playlist.prev()}));var r=X(H).attr("role","button");r.on(t,(function(){e.playlist.next()}));var i=_.div("fp-playlist-prev-preview"),o=_.div("fp-playlist-next-preview");return e.root.controls.btns.prepend(n),e.root.controls.btns.append(r),e.root.controls.btns.append(i),e.root.controls.btns.append(o),{prevButton:n,nextButton:r,prevPreview:i,nextPreview:o}}(o);o.reaper.put("skip_controls",s),o.on(i,(function(){for(var t in s)s[t]=0}))}}function W(t,e,n){t.empty();var r=t.append(_.ol("fp-playlist"));w.map(e,(function(t,i){var o=Q(t,e,n,i);o&&r.append(o)}))}function Q(t,e,n,r){if(t.title){var i={class:r==e.idx?"is-current "+function(t){return t.paused?"is-paused":"is-playing"}(n):"is-queued",onclick:Q.onclick.bind(null,t,e,n,r)};return _.li(i,[_.div("fp-color"),z(t),G(t,n)])}}function z(t){return _.div("video-info",[R("title",t),R("description",t)])}function G(t,e){var n=_.div("video-buttons",e.root.ui.findAll(".fp-switch").map((function(t){return _(t.cloneNode(!0)).removeClass("fp-switch")})));return t.poster&&(n.style.backgroundImage=["url(",t.poster,")"].join("")),n}Q.onclick=function(t,e,n,r){return e.idx!=r||n.paused?e.idx==r&&n.paused?n.play():(e.idx=r,void j(n,t,{should_play:!0})):n.pause()};function J(t){return Math.min(100*t,100)+"%"}function K(t,e){var n=_.div("fp-interstitial"),r=t.root.ui.find(".fp-middle");r.append(n),t.on(g.PLAYLIST_INTERSTITIAL,(function(i){var o=i.data;t.setState("is-interstitial",!0);var a=w.current_video(t.playlist.queue);a&&(n.empty().append(K.Innards(t,a,r,o)),e.advance&&K.animate_countdown(t,o,n.querySelector(".countdown")))})),t.on("src playing waiting",(function(){t.emit(g.PLAYLIST_INTERSTITIAL_END)})),t.on(g.PLAYLIST_INTERSTITIAL_END,(function(){t.setState("is-interstitial",!1)}))}K.animate_countdown=function(t,e,n){if(!n)throw new Error("no element to animate was passed");var r=e.config.delay,i=Date.now()+r,o=Date.now(),a=Math.ceil(1e3/60);!function u(){var l=Date.now();if(!(l>i)&&t.paused){if(!e.timer)return n.css({width:J(0)});requestAnimationFrame(u),l-o<a||(o=l,n.css({width:J(1-(i-l)/r)}))}}()},K.Innards=function(t,e,n,r){var i=_.div("left",n.findAll(".fp-switch").map((function(t){return _(t.cloneNode(!0)).removeClass("fp-switch")})));return e.poster&&(i.style.backgroundImage=["url(",e.poster,")"].join("")),[i,_.div("right",[_.div("up-next",[_.span().txt(t._t("playlist.up_next")),_.div("fp-color countdown")]),R("title",e),R("description",e),r.timer&&_.div({class:"cancel",onclick:function(t){return clearTimeout(r.timer),r.timer=0,_(t.target).remove(),t.preventDefault(),!1}},[_.span().txt(t._t("playlist.cancel"))])])]};var Z=["playlist","controls","shuffle","loop","advance","delay","player","skip_controls"],$=["src"];function tt(t){C(t)}function et(t,e){var n=this;n.queue=e,n.play=function(e){n.queue.idx=e,j(t,w.current_video(n.queue),{should_play:!0})},n.next=function(){n.queue.idx!==n.queue.last_idx&&n.play(n.queue.idx+1)},n.prev=function(){n.queue.idx&&n.play(n.queue.idx-1)},n.remove=function(e){n.queue.members[e]&&(n.queue.members.splice(e,1),n.queue.plays--,F(t,n.queue))},n.push=function(e){n.queue.members=n.queue.members.concat(e),n.queue.plays--,F(t,n.queue)},n.clear=function(){n.queue.members=[],n.queue.plays--,F(t,n.queue)}}function nt(t,e){e.delay="delay"in e?e.delay:1e4,tt(e);const n=function(t){var e={};for(var n in $.forEach((function(e){e in t&&(console.warn(new Error("unsupported attribute: "+e+" found on the top-level config")),delete t[e])})),t)~Z.indexOf(n)||(e[n]=t[n]);return e}(e);e=function(t,e){var n={};for(var r in t)Z.indexOf(r)<0||(n[r]=t[r]);for(r in e)Z.indexOf(r)<0||(n[r]=e[r]);return n}((t=flowplayer(t,n)).opts,e),new K(t,e);var r=nt.make_controls(t,e);return nt.attach_events(t,r,e),nt.fetch(e,(function(e){t.emit(g.PLAYLIST_READY,{queue:e,should_play:0===t.currentSrc.length})})),t}return nt.make_controls=function(t,e){var n=nt.cast_controls(e);if(n)return _(n),new V(n,t,e),n},nt.cast_controls=function(t){var e,n;if(N(n=t.controls)||O(n))return O(t.controls)?e=t.controls:N(t.controls)&&(e=document.querySelector(t.controls)),b("Count not find controls by Selector["+t.controls+"]",O(e)),e},nt.fetch=function(t,e){if(Array.isArray(t.playlist))return e(w.of(t.playlist,t));throw new Error("config.playlist must be an Array")},nt.attach_events=function(t,e,n){t.on(g.PLAYLIST_READY,(function(e){var r=e.data.queue,i=e.data.should_play;t.reaper.put("playlist",new et(t,r)),i&&D(t,r,n)})),t.on(r,(function(){if(w.is_ended(t.playlist.queue))return function(t,e){t.emit(g.PLAYLIST_ENDED),e.loop&&(t.playlist.queue=w.reset(t.playlist.queue),t.emit(g.PLAYLIST_LOOP),M(t,e,(function(){t.emit(g.PLAYLIST_READY,{queue:t.playlist.queue,should_play:!0})})))}(t,n);0!=n.advance&&D(t,t.playlist.queue,n)}))},nt.events=g,nt.VideoQueue=w,nt}));
